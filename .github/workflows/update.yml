name: Update V2Ray Subscription

on:
  schedule:
    - cron: '0 */6 * * *'  # Ù‡Ø± Û¶ Ø³Ø§Ø¹Øª ÛŒÚ© Ø¨Ø§Ø± Ø§Ø¬Ø±Ø§
  workflow_dispatch:  # Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ

permissions:
  contents: write  # Ø¯Ø§Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ù†ÙˆØ´ØªÙ† Ø¨Ù‡ Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨ Ø§Ú©Ø´Ù†

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ
        uses: actions/checkout@v4

      - name: Ù†ØµØ¨ Ù¾Ø§ÛŒØªÙˆÙ†
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
        run: pip install requests

      - name: Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª
        run: python update_subscriptions.py

      - name: Ø¨Ø±Ø±Ø³ÛŒ ØªØºÛŒÛŒØ±Ø§Øª Ùˆ Ø¢Ù¾Ø¯ÛŒØª Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add merged_subscription.txt
          git diff --cached --quiet || (git commit -m "ðŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø³Ø§Ø¨ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§" && git push)
